"use strict";
var express = require("express");
var Product = require("../model/product");
var ProductsModel = require("../model/products");
var Products = (function () {
    function Products() {
        this.productList = new ProductsModel.Products([
            new Product.Product(1, 'ABC', 1),
            new Product.Product(2, 'DEF', 12),
            new Product.Product(3, 'GHI')
        ]);
    }
    Products.routes = function () {
        var router = express.Router();
        var productsRoute = new Products();
        router.get('/products/', productsRoute.index.bind(productsRoute));
        router.post('/products/', productsRoute.create.bind(productsRoute));
        router.put('/products/:product_id', productsRoute.update.bind(productsRoute));
        router.delete('/products/:product_id', productsRoute.delete.bind(productsRoute));
        router.get('/products/:product', productsRoute.find.bind(productsRoute));
        router.post('/products/delete/:product_id', productsRoute.delete.bind(productsRoute));
        router.post('/products/update/:product_id', productsRoute.update.bind(productsRoute));
        return router;
    };
    Products.prototype.index = function (request, response) {
        response.json(this.productList.list());
    };
    Products.prototype.create = function (request, response) {
        var productName = request.body.product_name;
        var productQuantity = parseInt(request.body.quantity) || 0;
        if (!productName) {
            response.status(500).send('Product name not found');
            return;
        }
        response.json(this.productList.add(productName, productQuantity));
    };
    Products.prototype.update = function (request, response) {
        var productId = parseInt(request.params.product_id);
        var product = this.productList.fetch(productId);
        var productName = request.body.product_name;
        var productQuantity = request.body.quantity;
        if (!product) {
            response.status(404).send('Product not found');
            return;
        }
        if (productName !== undefined) {
            product.setName(productName);
        }
        if (productQuantity !== undefined) {
            product.updateQuantity(productQuantity);
        }
        response.json(product);
    };
    Products.prototype.delete = function (request, response) {
        var productId = parseInt(request.params.product_id);
        var wasDeleted = this.productList.delete(productId);
        if (!wasDeleted) {
            response.status(404).send('Product not found');
            return;
        }
        else {
            response.json({ success: true });
        }
    };
    Products.prototype.find = function (request, response) {
        var productQuery = request.params.product;
        var product = this.productList.find(productQuery);
        if (!product) {
            response.status(404).send('Product not found');
            return;
        }
        response.json(product);
    };
    return Products;
}());
exports.Products = Products;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUM7SUFFTCxDQUFDO0lBQ00sdUJBQUksR0FBWCxVQUFZLE9BQXdCLEVBQUUsUUFBMEI7UUFDNUQsSUFBSSxZQUFZLEdBQVcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFDbEQsSUFBSSxPQUFPLEdBQW9CLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRW5FLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNYLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUNELFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFM0IsQ0FBQztJQUNMLGVBQUM7QUFBRCxDQXBGQSxBQW9GQyxJQUFBO0FBcEZZLDRCQUFRIiwiZmlsZSI6InJvdXRlcy9wcm9kdWN0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyBQcm9kdWN0IGZyb20gJy4uL21vZGVsL3Byb2R1Y3QnO1xuaW1wb3J0ICogYXMgUHJvZHVjdHNNb2RlbCBmcm9tICcuLi9tb2RlbC9wcm9kdWN0cyc7XG5cbmV4cG9ydCBjbGFzcyBQcm9kdWN0cyB7XG4gICAgcHJpdmF0ZSBwcm9kdWN0TGlzdDogUHJvZHVjdHNNb2RlbC5Qcm9kdWN0cztcbiAgICBwdWJsaWMgc3RhdGljIHJvdXRlcygpOiBleHByZXNzLlJvdXRlciB7XG4gICAgICAgIGxldCByb3V0ZXI6IGV4cHJlc3MuUm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbiAgICAgICAgbGV0IHByb2R1Y3RzUm91dGU6IFByb2R1Y3RzID0gbmV3IFByb2R1Y3RzKCk7XG4gICAgICAgIHJvdXRlci5nZXQoJy9wcm9kdWN0cy8nLCBwcm9kdWN0c1JvdXRlLmluZGV4LmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xuICAgICAgICByb3V0ZXIucG9zdCgnL3Byb2R1Y3RzLycsIHByb2R1Y3RzUm91dGUuY3JlYXRlLmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xuICAgICAgICByb3V0ZXIucHV0KCcvcHJvZHVjdHMvOnByb2R1Y3RfaWQnLCBwcm9kdWN0c1JvdXRlLnVwZGF0ZS5iaW5kKHByb2R1Y3RzUm91dGUpKTtcbiAgICAgICAgcm91dGVyLmRlbGV0ZSgnL3Byb2R1Y3RzLzpwcm9kdWN0X2lkJywgcHJvZHVjdHNSb3V0ZS5kZWxldGUuYmluZChwcm9kdWN0c1JvdXRlKSk7XG4gICAgICAgIHJvdXRlci5nZXQoJy9wcm9kdWN0cy86cHJvZHVjdCcsIHByb2R1Y3RzUm91dGUuZmluZC5iaW5kKHByb2R1Y3RzUm91dGUpKTtcbiAgICAgICAgcm91dGVyLnBvc3QoJy9wcm9kdWN0cy9kZWxldGUvOnByb2R1Y3RfaWQnLCBwcm9kdWN0c1JvdXRlLmRlbGV0ZS5iaW5kKHByb2R1Y3RzUm91dGUpKTtcbiAgICAgICAgcm91dGVyLnBvc3QoJy9wcm9kdWN0cy91cGRhdGUvOnByb2R1Y3RfaWQnLCBwcm9kdWN0c1JvdXRlLnVwZGF0ZS5iaW5kKHByb2R1Y3RzUm91dGUpKTtcbiAgICAgICAgcmV0dXJuIHJvdXRlcjtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5wcm9kdWN0TGlzdCA9IG5ldyBQcm9kdWN0c01vZGVsLlByb2R1Y3RzKFtcbiAgICAgICAgICAgIG5ldyBQcm9kdWN0LlByb2R1Y3QoMSwgJ0FCQycsIDEpLFxuICAgICAgICAgICAgbmV3IFByb2R1Y3QuUHJvZHVjdCgyLCAnREVGJywgMTIpLFxuICAgICAgICAgICAgbmV3IFByb2R1Y3QuUHJvZHVjdCgzLCAnR0hJJylcbiAgICAgICAgXSlcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5kZXgocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xuICAgICAgICByZXNwb25zZS5qc29uKHRoaXMucHJvZHVjdExpc3QubGlzdCgpKTtcbiAgICB9XG4gICAgcHVibGljIGNyZWF0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XG4gICAgICAgIGxldCBwcm9kdWN0TmFtZTogc3RyaW5nID0gcmVxdWVzdC5ib2R5LnByb2R1Y3RfbmFtZTtcbiAgICAgICAgbGV0IHByb2R1Y3RRdWFudGl0eTogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5ib2R5LnF1YW50aXR5KSB8fCAwO1xuICAgICAgICBpZiAoIXByb2R1Y3ROYW1lKSB7XG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKCdQcm9kdWN0IG5hbWUgbm90IGZvdW5kJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzcG9uc2UuanNvbih0aGlzLnByb2R1Y3RMaXN0LmFkZChwcm9kdWN0TmFtZSwgcHJvZHVjdFF1YW50aXR5KSk7XG4gICAgfVxuICAgIHB1YmxpYyB1cGRhdGUocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSlcbiAgICB7XG4gICAgICAgIGxldCBwcm9kdWN0SWQ6IG51bWJlciA9IHBhcnNlSW50KHJlcXVlc3QucGFyYW1zLnByb2R1Y3RfaWQpO1xuICAgICAgICBsZXQgcHJvZHVjdDogUHJvZHVjdC5Qcm9kdWN0ID0gdGhpcy5wcm9kdWN0TGlzdC5mZXRjaChwcm9kdWN0SWQpO1xuICAgICAgICBsZXQgcHJvZHVjdE5hbWU6IHN0cmluZyA9IHJlcXVlc3QuYm9keS5wcm9kdWN0X25hbWU7XG4gICAgICAgIGxldCBwcm9kdWN0UXVhbnRpdHk6IG51bWJlciA9IHJlcXVlc3QuYm9keS5xdWFudGl0eTtcblxuICAgICAgICBpZiAoIXByb2R1Y3QpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ1Byb2R1Y3Qgbm90IGZvdW5kJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZihwcm9kdWN0TmFtZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdC5zZXROYW1lKHByb2R1Y3ROYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHByb2R1Y3RRdWFudGl0eSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdC51cGRhdGVRdWFudGl0eShwcm9kdWN0UXVhbnRpdHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzcG9uc2UuanNvbihwcm9kdWN0KTtcbiAgICB9XG4gICAgcHVibGljIGRlbGV0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XG4gICAgICAgIGxldCBwcm9kdWN0SWQ6IG51bWJlciA9IHBhcnNlSW50KHJlcXVlc3QucGFyYW1zLnByb2R1Y3RfaWQpO1xuICAgICAgICBsZXQgd2FzRGVsZXRlZDogQm9vbGVhbiA9IHRoaXMucHJvZHVjdExpc3QuZGVsZXRlKHByb2R1Y3RJZCk7XG5cbiAgICAgICAgaWYgKCF3YXNEZWxldGVkKSB7XG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNDA0KS5zZW5kKCdQcm9kdWN0IG5vdCBmb3VuZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgIHJlc3BvbnNlLmpzb24oe3N1Y2Nlc3M6IHRydWV9KTtcbiAgICAgICAgfVxuXG4gICAgfVxuICAgIHB1YmxpYyBmaW5kKHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICAgICAgbGV0IHByb2R1Y3RRdWVyeTogc3RyaW5nID0gcmVxdWVzdC5wYXJhbXMucHJvZHVjdDtcbiAgICAgICAgbGV0IHByb2R1Y3Q6IFByb2R1Y3QuUHJvZHVjdCA9IHRoaXMucHJvZHVjdExpc3QuZmluZChwcm9kdWN0UXVlcnkpO1xuXG4gICAgICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCgnUHJvZHVjdCBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXNwb25zZS5qc29uKHByb2R1Y3QpO1xuXG4gICAgfVxufVxuIl19

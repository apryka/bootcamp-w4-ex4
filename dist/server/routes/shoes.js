"use strict";
var express = require("express");
var Shoe = require("../model/shoe");
var ShoesModel = require("../model/shoes");
var Shoes = (function () {
    function Shoes() {
        this.shoesList = new ShoesModel.Shoes([
            new Shoe.Shoe(1043, 'Air Jordan XXXI', 43, 8),
            new Shoe.Shoe(1044, 'Air Jordan XXXI', 44, 3),
            new Shoe.Shoe(1045, 'Air Jordan XXXI', 45, 4),
            new Shoe.Shoe(2043, 'Air Jordan 1 Retro Ultra High', 43, 6),
            new Shoe.Shoe(2044, 'Air Jordan 1 Retro Ultra High', 44, 6),
            new Shoe.Shoe(2045, 'Air Jordan 1 Retro Ultra High', 45, 6),
            new Shoe.Shoe(3045, 'Air Jordan 1 Retro High', 45, 2),
            new Shoe.Shoe(3046, 'Air Jordan 1 Retro High', 46, 2),
            new Shoe.Shoe(3047, 'Air Jordan 1 Retro High', 47, 2),
            new Shoe.Shoe(4044, 'Nike Hyperdunk 2016 Low', 44, 5),
            new Shoe.Shoe(4046, 'Nike Hyperdunk 2016 Low', 46, 2),
            new Shoe.Shoe(4047, 'Nike Hyperdunk 2016 Low', 47, 2)
        ]);
    }
    Shoes.routes = function () {
        var router = express.Router();
        var shoesRoute = new Shoes();
        router.get('/shoes/', shoesRoute.index.bind(shoesRoute));
        router.post('/shoes/', shoesRoute.create.bind(shoesRoute));
        router.put('/shoes/:shoe_id', shoesRoute.update.bind(shoesRoute));
        router.delete('/shoes/:shoe_id', shoesRoute.delete.bind(shoesRoute));
        router.get('/shoes/:shoe', shoesRoute.find.bind(shoesRoute));
        router.post('/shoes/delete/:shoe_id', shoesRoute.delete.bind(shoesRoute));
        router.post('/shoes/update/:shoe_id', shoesRoute.update.bind(shoesRoute));
        return router;
    };
    Shoes.prototype.index = function (request, response) {
        response.json(this.shoesList.list());
    };
    Shoes.prototype.create = function (request, response) {
        var shoeName = request.body.shoe_name;
        var shoeSize = request.body.shoe_size;
        var shoeQuantity = request.body.shoe_quantity;
        if (!shoeName) {
            response.status(500).send('Shoe name not found');
            return;
        }
        if (!shoeSize) {
            response.status(500).send('Shoe size not found');
            return;
        }
        if (!shoeQuantity) {
            response.status(500).send('Shoe quantity not found');
            return;
        }
        response.json(this.shoesList.add(shoeName, shoeSize, shoeQuantity));
    };
    Shoes.prototype.update = function (request, response) {
        var shoeId = parseInt(request.params.shoe_id);
        var shoe = this.shoesList.fetch(shoeId);
        var shoeName = request.body.shoe_name;
        var shoeSize = request.body.shoe_size;
        var shoeQuantity = request.body.shoe_quantity;
        if (!shoe) {
            response.status(404).send('Shoe not found');
            return;
        }
        if (shoeName !== undefined) {
            shoe.setName(shoeName);
        }
        if (shoeSize !== undefined) {
            shoe.setSize(shoeSize);
        }
        if (shoeQuantity !== undefined) {
            shoe.updateQuantity(shoeQuantity);
        }
        response.json(shoe);
    };
    Shoes.prototype.delete = function (request, response) {
        var shoeId = parseInt(request.params.shoe_id);
        var wasDeleted = this.shoesList.delete(shoeId);
        if (!wasDeleted) {
            response.status(404).send('Shoe not found');
            return;
        }
        else {
            response.json({ success: true });
        }
    };
    Shoes.prototype.find = function (request, response) {
        var shoeQuery = request.params.shoe;
        var shoe = this.shoesList.find(shoeQuery);
        if (!shoe) {
            response.status(404).send('Shoe not found');
            return;
        }
        response.json(shoe);
    };
    return Shoes;
}());
exports.Shoes = Shoes;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXhELEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNkLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDNUMsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUNELElBQUksQ0FDSixDQUFDO1lBQ0MsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ2pDLENBQUM7SUFFTCxDQUFDO0lBQ00sb0JBQUksR0FBWCxVQUFZLE9BQXdCLEVBQUUsUUFBMEI7UUFDNUQsSUFBSSxTQUFTLEdBQVcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDNUMsSUFBSSxJQUFJLEdBQWMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFckQsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1IsUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUM7UUFDWCxDQUFDO1FBQ0QsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUV4QixDQUFDO0lBQ0wsWUFBQztBQUFELENBMUdBLEFBMEdDLElBQUE7QUExR1ksc0JBQUsiLCJmaWxlIjoicm91dGVzL3Nob2VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0ICogYXMgU2hvZSBmcm9tICcuLi9tb2RlbC9zaG9lJztcclxuaW1wb3J0ICogYXMgU2hvZXNNb2RlbCBmcm9tICcuLi9tb2RlbC9zaG9lcydcclxuXHJcbmV4cG9ydCBjbGFzcyBTaG9lcyB7XHJcbiAgICBwcml2YXRlIHNob2VzTGlzdDogU2hvZXNNb2RlbC5TaG9lcztcclxuICAgIHB1YmxpYyBzdGF0aWMgcm91dGVzKCk6IGV4cHJlc3MuUm91dGVyIHtcclxuICAgICAgICBsZXQgcm91dGVyOiBleHByZXNzLlJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbiAgICAgICAgbGV0IHNob2VzUm91dGU6IFNob2VzID0gbmV3IFNob2VzKCk7XHJcbiAgICAgICAgcm91dGVyLmdldCgnL3Nob2VzLycsIHNob2VzUm91dGUuaW5kZXguYmluZChzaG9lc1JvdXRlKSk7XHJcbiAgICAgICAgcm91dGVyLnBvc3QoJy9zaG9lcy8nLCBzaG9lc1JvdXRlLmNyZWF0ZS5iaW5kKHNob2VzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIucHV0KCcvc2hvZXMvOnNob2VfaWQnLCBzaG9lc1JvdXRlLnVwZGF0ZS5iaW5kKHNob2VzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIuZGVsZXRlKCcvc2hvZXMvOnNob2VfaWQnLCBzaG9lc1JvdXRlLmRlbGV0ZS5iaW5kKHNob2VzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIuZ2V0KCcvc2hvZXMvOnNob2UnLCBzaG9lc1JvdXRlLmZpbmQuYmluZChzaG9lc1JvdXRlKSk7XHJcbiAgICAgICAgcm91dGVyLnBvc3QoJy9zaG9lcy9kZWxldGUvOnNob2VfaWQnLCBzaG9lc1JvdXRlLmRlbGV0ZS5iaW5kKHNob2VzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIucG9zdCgnL3Nob2VzL3VwZGF0ZS86c2hvZV9pZCcsIHNob2VzUm91dGUudXBkYXRlLmJpbmQoc2hvZXNSb3V0ZSkpO1xyXG4gICAgICAgIHJldHVybiByb3V0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5zaG9lc0xpc3QgPSBuZXcgU2hvZXNNb2RlbC5TaG9lcyhbXHJcbiAgICAgICAgICAgIG5ldyBTaG9lLlNob2UoMTA0MywgJ0FpciBKb3JkYW4gWFhYSScsIDQzLCA4KSxcclxuICAgICAgICAgICAgbmV3IFNob2UuU2hvZSgxMDQ0LCAnQWlyIEpvcmRhbiBYWFhJJywgNDQsIDMpLFxyXG4gICAgICAgICAgICBuZXcgU2hvZS5TaG9lKDEwNDUsICdBaXIgSm9yZGFuIFhYWEknLCA0NSwgNCksXHJcbiAgICAgICAgICAgIG5ldyBTaG9lLlNob2UoMjA0MywgJ0FpciBKb3JkYW4gMSBSZXRybyBVbHRyYSBIaWdoJywgNDMsIDYpLFxyXG4gICAgICAgICAgICBuZXcgU2hvZS5TaG9lKDIwNDQsICdBaXIgSm9yZGFuIDEgUmV0cm8gVWx0cmEgSGlnaCcsIDQ0LCA2KSxcclxuICAgICAgICAgICAgbmV3IFNob2UuU2hvZSgyMDQ1LCAnQWlyIEpvcmRhbiAxIFJldHJvIFVsdHJhIEhpZ2gnLCA0NSwgNiksXHJcbiAgICAgICAgICAgIG5ldyBTaG9lLlNob2UoMzA0NSwgJ0FpciBKb3JkYW4gMSBSZXRybyBIaWdoJywgNDUsIDIpLFxyXG4gICAgICAgICAgICBuZXcgU2hvZS5TaG9lKDMwNDYsICdBaXIgSm9yZGFuIDEgUmV0cm8gSGlnaCcsIDQ2LCAyKSxcclxuICAgICAgICAgICAgbmV3IFNob2UuU2hvZSgzMDQ3LCAnQWlyIEpvcmRhbiAxIFJldHJvIEhpZ2gnLCA0NywgMiksXHJcbiAgICAgICAgICAgIG5ldyBTaG9lLlNob2UoNDA0NCwgJ05pa2UgSHlwZXJkdW5rIDIwMTYgTG93JywgNDQsIDUpLFxyXG4gICAgICAgICAgICBuZXcgU2hvZS5TaG9lKDQwNDYsICdOaWtlIEh5cGVyZHVuayAyMDE2IExvdycsIDQ2LCAyKSxcclxuICAgICAgICAgICAgbmV3IFNob2UuU2hvZSg0MDQ3LCAnTmlrZSBIeXBlcmR1bmsgMjAxNiBMb3cnLCA0NywgMilcclxuICAgICAgICBdKVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbmRleChyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XHJcbiAgICAgICAgcmVzcG9uc2UuanNvbih0aGlzLnNob2VzTGlzdC5saXN0KCkpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGNyZWF0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XHJcbiAgICAgICAgbGV0IHNob2VOYW1lOiBzdHJpbmcgPSByZXF1ZXN0LmJvZHkuc2hvZV9uYW1lO1xyXG4gICAgICAgIGxldCBzaG9lU2l6ZTogbnVtYmVyID0gcmVxdWVzdC5ib2R5LnNob2Vfc2l6ZTtcclxuICAgICAgICBsZXQgc2hvZVF1YW50aXR5OiBudW1iZXIgPSByZXF1ZXN0LmJvZHkuc2hvZV9xdWFudGl0eTtcclxuICAgICAgICBpZiAoIXNob2VOYW1lKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg1MDApLnNlbmQoJ1Nob2UgbmFtZSBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXNob2VTaXplKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg1MDApLnNlbmQoJ1Nob2Ugc2l6ZSBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXNob2VRdWFudGl0eSkge1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKCdTaG9lIHF1YW50aXR5IG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc3BvbnNlLmpzb24odGhpcy5zaG9lc0xpc3QuYWRkKHNob2VOYW1lLCBzaG9lU2l6ZSwgc2hvZVF1YW50aXR5KSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdXBkYXRlKHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IHNob2VJZDogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5wYXJhbXMuc2hvZV9pZCk7XHJcbiAgICAgICAgbGV0IHNob2U6IFNob2UuU2hvZSA9IHRoaXMuc2hvZXNMaXN0LmZldGNoKHNob2VJZCk7XHJcbiAgICAgICAgbGV0IHNob2VOYW1lOiBzdHJpbmcgPSByZXF1ZXN0LmJvZHkuc2hvZV9uYW1lO1xyXG4gICAgICAgIGxldCBzaG9lU2l6ZTogbnVtYmVyID0gcmVxdWVzdC5ib2R5LnNob2Vfc2l6ZTtcclxuICAgICAgICBsZXQgc2hvZVF1YW50aXR5OiBudW1iZXIgPSByZXF1ZXN0LmJvZHkuc2hvZV9xdWFudGl0eTtcclxuXHJcbiAgICAgICAgaWYgKCFzaG9lKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ1Nob2Ugbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHNob2VOYW1lICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc2hvZS5zZXROYW1lKHNob2VOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoc2hvZVNpemUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzaG9lLnNldFNpemUoc2hvZVNpemUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihzaG9lUXVhbnRpdHkgIT09IHVuZGVmaW5lZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzaG9lLnVwZGF0ZVF1YW50aXR5KHNob2VRdWFudGl0eSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXNwb25zZS5qc29uKHNob2UpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGRlbGV0ZShyZXF1ZXN0OiBleHByZXNzLlJlcXVlc3QsIHJlc3BvbnNlOiBleHByZXNzLlJlc3BvbnNlKSB7XHJcbiAgICAgICAgbGV0IHNob2VJZDogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5wYXJhbXMuc2hvZV9pZCk7XHJcbiAgICAgICAgbGV0IHdhc0RlbGV0ZWQ6IEJvb2xlYW4gPSB0aGlzLnNob2VzTGlzdC5kZWxldGUoc2hvZUlkKTtcclxuXHJcbiAgICAgICAgaWYgKCF3YXNEZWxldGVkKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ1Nob2Ugbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJlc3BvbnNlLmpzb24oe3N1Y2Nlc3M6IHRydWV9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIGZpbmQocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgICAgIGxldCBzaG9lUXVlcnk6IHN0cmluZyA9IHJlcXVlc3QucGFyYW1zLnNob2U7XHJcbiAgICAgICAgbGV0IHNob2U6IFNob2UuU2hvZSA9IHRoaXMuc2hvZXNMaXN0LmZpbmQoc2hvZVF1ZXJ5KTtcclxuXHJcbiAgICAgICAgaWYgKCFzaG9lKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ1Nob2Ugbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzcG9uc2UuanNvbihzaG9lKTtcclxuXHJcbiAgICB9XHJcbn1cclxuIl19
